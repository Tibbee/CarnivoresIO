# `.3df` File Format Specification

### Header (16 bytes)

| Offset | Type   | Size | Name        | Description             |
| ------ | ------ | ---- | ----------- | ----------------------- |
| 0x0000 | uint32 | 4    | VCount      | Number of vertices      |
| 0x0004 | uint32 | 4    | FCount      | Number of faces         |
| 0x0008 | uint32 | 4    | BoneCount   | Number of bones         |
| 0x000C | uint32 | 4    | TextureSize | Texture length in bytes |

### Face (64 bytes each)

| Offset | Type      | Size | Name    | Description                       |
| ------ | --------- | ---- | ------- | --------------------------------- |
| 0x00   | uint32    | 4    | v1      | Vertex 1 index                    |
| 0x04   | uint32    | 4    | v2      | Vertex 2 index                    |
| 0x08   | uint32    | 4    | v3      | Vertex 3 index                    |
| 0x0C   | uint32    | 4    | tax     | v1 texture U coordinate           |
| 0x10   | uint32    | 4    | tbx     | v2 texture U coordinate           |
| 0x14   | uint32    | 4    | tcx     | v3 texture U coordinate           |
| 0x18   | uint32    | 4    | tay     | v1 texture V coordinate           |
| 0x1C   | uint32    | 4    | tby     | v2 texture V coordinate           |
| 0x20   | uint32    | 4    | tcy     | v3 texture V coordinate           |
| 0x24   | uint16    | 2    | flags   | Bitfield (see **Face Flags**)     |
| 0x26   | uint16    | 2    | DMask   | Unused (possibly editor-specific) |
| 0x28   | uint32    | 4    | Distant | Purpose unknown                   |
| 0x2C   | uint32    | 4    | Next    | Index to other faces?             |
| 0x30   | uint32    | 4    | group   | Unused (possibly editor-specific) |
| 0x34   | byte\[12] | 12   | reserv  | Reserved (unused, always 0x00)    |

#### Face Flags (`flags` bitfield)

| Bit  | Mask   | Name          | Description                      |
| ---- | ------ | ------------- | -------------------------------- |
| 0    | 0x0001 | sfDoubleSide  | Face textured on both sides      |
| 1    | 0x0002 | sfDarkBack    | Dark back side                   |
| 2    | 0x0004 | sfOpacity     | Transparent                      |
| 3    | 0x0008 | sfTransparent | Non-solid (bullets pass through) |
| 4    | 0x0010 | sfMortal      | Marks as a target zone           |
| 5    | 0x0020 | sfPhong       | Phong-mapped                     |
| 6    | 0x0040 | sfEnvMap      | Environment-mapped               |
| 7    | 0x0080 | sfNeedVC      | Purpose unknown                  |
| 8–14 | —      | —             | Unused                           |
| 15   | 0x8000 | sfDark        | Dark front side                  |

### Vertex (16 bytes each)

| Offset | Type   | Size | Name  | Description                            |
| ------ | ------ | ---- | ----- | -------------------------------------- |
| 0x00   | float  | 4    | X     | X coordinate                           |
| 0x04   | float  | 4    | Y     | Y coordinate                           |
| 0x08   | float  | 4    | Z     | Z coordinate                           |
| 0x0C   | uint16 | 2    | owner | Bone index attached to                 |
| 0x0E   | uint16 | 2    | hide  | Hidden in Designer 2 (ignored in-game) |

### Bone (48 bytes each)

| Offset | Type      | Size | Name   | Description                            |
| ------ | --------- | ---- | ------ | -------------------------------------- |
| 0x00   | byte\[32] | 32   | name   | Bone name (ASCII string)               |
| 0x20   | float     | 4    | X      | X coordinate                           |
| 0x24   | float     | 4    | Y      | Y coordinate                           |
| 0x28   | float     | 4    | Z      | Z coordinate                           |
| 0x2C   | int16     | 2    | parent | Parent bone index (`-1` if none)       |
| 0x2E   | uint16    | 2    | hide   | Hidden in Designer 2 (ignored in-game) |

### Texture (variable size)

* **Size**: `TextureSize` (from header)
* **Format**: 16-bit TGA-style, ARGB1555
* **Width**: Always 256 pixels

